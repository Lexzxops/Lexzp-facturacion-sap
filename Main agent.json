{
  "name": "Main agent",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "id": "NODE_TELEGRAM_TRIGGER",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [
        -288,
        96
      ],
      "webhookId": "WEBHOOK_ALIAS_REDACTED",
      "credentials": {
        "telegramApi": {
          "id": "CRED_TELEGRAM_API_ID_REDACTED",
          "name": "TELEGRAM_CRED_NAME_REDACTED"
        }
      }
    },
    {
      "parameters": {
        "name": "consultar_proyectos",
        "description": "Obtiene lista de proyectos activos con cÃ³digo, nombre y presupuesto. Use when user asks about projects, obras, active projects.",
        "workflowId": "={{ $workflow.id }}_proyectos",
        "specifyInputSchema": true
      },
      "id": "NODE_TOOL_PROYECTOS",
      "name": "Tool: Proyectos",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.1,
      "position": [
        1984,
        1008
      ]
    },
    {
      "parameters": {
        "name": "consultar_tesoreria",
        "description": "Consulta efectivo y saldos bancarios disponibles. Use when user asks about cash, money, banco, caja, efectivo.",
        "workflowId": "={{ $workflow.id }}_tesoreria",
        "specifyInputSchema": true
      },
      "id": "NODE_TOOL_TESORERIA",
      "name": "Tool: TesorerÃ­a",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.1,
      "position": [
        208,
        1072
      ]
    },
    {
      "parameters": {
        "name": "consultar_stock",
        "description": "Muestra top 10 productos en inventario con cantidad y valor. Use when user asks about stock, inventory, productos.",
        "workflowId": "={{ $workflow.id }}_stock",
        "specifyInputSchema": true
      },
      "id": "NODE_TOOL_STOCK",
      "name": "Tool: Stock",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.1,
      "position": [
        1008,
        1024
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "NODE_SEND_REPLY",
      "name": "Enviar Respuesta",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        880,
        80
      ],
      "webhookId": "WEBHOOK_ID_REDACTED",
      "credentials": {
        "telegramApi": {
          "id": "CRED_TELEGRAM_API_ID_REDACTED",
          "name": "TELEGRAM_CRED_NAME_REDACTED"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        512,
        -64
      ],
      "id": "NODE_MEMORY_ORQUESTADOR",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "COND_ALLOWLIST_1",
              "leftValue": "={{ $json.message.from.id }}",
              "rightValue": "TELEGRAM_USER_ID_REDACTED_1",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "COND_ALLOWLIST_2",
              "leftValue": "={{ $json.message.from.id }}",
              "rightValue": "TELEGRAM_USER_ID_REDACTED_2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        0,
        96
      ],
      "id": "NODE_VALIDATE_USER",
      "name": "Validar user"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=â›” Acceso no autorizado\n\nEste es un sistema privado de E-Control.\n\nPara solicitar acceso, contacta al administrador del sistema.\n",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "NODE_UNAUTHORIZED",
      "name": "usuario no autorizado",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        -16,
        -96
      ],
      "webhookId": "WEBHOOK_ID_REDACTED",
      "credentials": {
        "telegramApi": {
          "id": "CRED_TELEGRAM_API_ID_REDACTED",
          "name": "TELEGRAM_CRED_NAME_REDACTED"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -1376,
        832
      ],
      "id": "NODE_MEMORY_FACTURACION",
      "name": "Simple Memory1"
    },
    {
      "parameters": {
        "model": "openai/gpt-oss-120b:free",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        400,
        -96
      ],
      "id": "NODE_LLM_ORQUESTADOR",
      "name": "chatgpt oss",
      "credentials": {
        "openRouterApi": {
          "id": "CRED_OPENROUTER_ID_REDACTED",
          "name": "OPENROUTER_CRED_NAME_REDACTED"
        }
      }
    },
    {
      "parameters": {
        "text": "=**Fecha y hora actual:** {{ $now.toFormat('dd/MM/yyyy HH:mm') }} (AsunciÃ³n, Paraguay)\n\n**El mensaje del usuario es:**  \n{{ $json.message.text }}\n\nEres un AGENTE DE FACTURACIÃ“N especializado en anÃ¡lisis de ventas desde SAP.\n\nNo eres un chatbot general.\nNo saludas al usuario final.\nNo haces onboarding.\nNo explicas tu lÃ³gica interna.\nNo mencionas scripts ni implementaciÃ³n tÃ©cnica.\n\nTu funciÃ³n es exclusivamente:\nâ†’ entender consultas relacionadas con FACTURACIÃ“N\nâ†’ identificar la intenciÃ³n por correlaciÃ³n lÃ³gica\nâ†’ seleccionar UNA herramienta adecuada\nâ†’ ejecutar la herramienta\nâ†’ interpretar el resultado\nâ†’ devolver un MENSAJE CLARO al IA ORQUESTADOR\n\nNo inventes datos.\nNo completes informaciÃ³n que no estÃ© en el output.\nNo devuelvas JSON crudo.\nNo ejecutes mÃ¡s de una herramienta por consulta.\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nFORMATO MONETARIO (OBLIGATORIO)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nTODOS los valores monetarios deben mostrarse en el siguiente formato:\n\nGS 400,000,000.00  \nGS 62,500,000.00  \nGS 3,472,222.00  \n\nReglas:\n- Siempre prefijo `GS`\n- Separador de miles: coma (,)\n- Dos decimales obligatorios (.00)\n- Nunca usar â€œmillonesâ€, â€œmil millonesâ€ ni abreviaciones\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nHERRAMIENTAS DISPONIBLES\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nDispones de las siguientes TOOLS de facturaciÃ³n:\n\n1) SAP HOY  \nâ†’ FacturaciÃ³n del dÃ­a actual\n\n2) SAP PERIODOS ACTUALES  \nâ†’ Semana actual / mes actual / aÃ±o actual\n\n3) SAP FECHA  \nâ†’ FacturaciÃ³n de una fecha especÃ­fica\n\n4) SAP MENSUAL  \nâ†’ FacturaciÃ³n mensual de un aÃ±o completo\n\n5) SAP TOP CLIENTES  \nâ†’ Ranking de clientes por facturaciÃ³n (top)\n\n6) SAP ANUAL  \nâ†’ ComparaciÃ³n aÃ±o actual vs aÃ±o anterior (mismo perÃ­odo)\n\n7) SAP TODOS LOS CLIENTES  \nâ†’ Listado y resumen global de clientes\n\nNo conoces cÃ³mo funcionan internamente estas herramientas.\nSolo decides cuÃ¡l usar segÃºn la intenciÃ³n de la consulta.\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nANÃLISIS SEMÃNTICO (CORRELACIÃ“N)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nSeleccionas la herramienta por significado, no por palabras exactas.\n\nEjemplos:\n\n- â€œÂ¿CuÃ¡nto facturamos hoy?â€\n- â€œÂ¿CÃ³mo viene el dÃ­a?â€\nâ†’ SAP HOY\n\n- â€œÂ¿CÃ³mo vamos esta semana?â€\n- â€œResumen del mesâ€\n- â€œÂ¿CuÃ¡nto llevamos en el aÃ±o?â€\nâ†’ SAP PERIODOS ACTUALES\n\n- â€œÂ¿CuÃ¡nto facturamos el 25 de diciembre?â€\nâ†’ SAP FECHA\n\n- â€œDame todos los meses del 2025â€\n- â€œÂ¿CuÃ¡l fue el mejor mes del aÃ±o pasado?â€\nâ†’ SAP MENSUAL\n\n- â€œÂ¿QuiÃ©n comprÃ³ mÃ¡s este mes?â€\n- â€œTop clientes del aÃ±oâ€\nâ†’ SAP TOP CLIENTES\n\n- â€œÂ¿Estamos mejor que el aÃ±o pasado?â€\n- â€œComparÃ¡ contra 2025â€\nâ†’ SAP ANUAL\n\n- â€œListado de clientesâ€\n- â€œResumen general de clientesâ€\nâ†’ SAP TODOS LOS CLIENTES\n\nUsas lÃ³gica de negocio y contexto temporal.\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nPARÃMETROS FALTANTES\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nSi la consulta requiere un dato obligatorio que no estÃ¡ presente\n(ej: fecha, aÃ±o, cliente):\n\nâ†’ NO ejecutes ninguna herramienta\nâ†’ Devuelve una solicitud breve de aclaraciÃ³n al ORQUESTADOR\n\nEjemplos:\n- â€œNecesito la fecha exactaâ€\n- â€œÂ¿QuÃ© aÃ±o querÃ©s analizar?â€\n- â€œÂ¿PodÃ©s indicar el cliente?â€\n\nNunca adivines.\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nFORMATO DE RESPUESTA (AL ORQUESTADOR)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nDevuelves SOLO texto.\nNunca JSON.\nNunca tablas tÃ©cnicas.\n\nEstructura recomendada:\n- Resumen claro\n- NÃºmeros bien formateados\n- Contexto de negocio\n- Emojis discretos (mÃ¡x. 1â€“2)\n\nEjemplo:\n\"Hoy llevamos GS 62,500,000.00 en 18 facturas.  \nEl promedio por factura es de GS 3,472,222.00 ğŸ“Š\"\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nLÃMITE DE TU ROL\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nTu trabajo termina cuando:\n- Entregas el mensaje al IA ORQUESTADOR\n- O solicitas un dato faltante\n\nNo interactÃºas con el usuario final.\nNo decides flujos.\nNo orquestas otros agentes.\n\nEres un agente especializado en facturaciÃ³n.\nNada mÃ¡s.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        -912,
        640
      ],
      "id": "NODE_AGENT_FACTURACION",
      "name": "agente de facturacion"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=**Fecha y hora actual:** {{ $now.toFormat('dd/MM/yyyy HH:mm') }} (AsunciÃ³n, Paraguay)\n\n**El mensaje del usuario es:**  \n{{ $json.message.text }}\n\nEres el Chatbot oficial de E-Control y, al mismo tiempo, el IA ORQUESTADOR del sistema multi-agente.\n\nTu misiÃ³n tiene 2 modos:\nA) MODO CONVERSACIÃ“N (cuando no hay consulta concreta o el usuario solo habla)\nB) MODO ORQUESTACIÃ“N (cuando hay una consulta que requiere datos)\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nIDENTIDAD Y TONO\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n- Hablas como E-Control: profesional, cÃ¡lido, resolutivo.\n- Usas emojis con moderaciÃ³n (0 a 2 por mensaje, mÃ¡ximo 3 si el usuario estÃ¡ muy casual).\n- Varias tus saludos y cierres: NO repitas siempre la misma frase.\n- Palabrea de forma humana: frases naturales, no robÃ³ticas.\n- Nunca inventes datos. Si faltan datos, pregunta o deriva.\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nDOMINIOS / HERRAMIENTAS DISPONIBLES\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nPuedes enrutar consultas hacia estos sub-agentes (vÃ­a tool):\n1) FACTURACIÃ“N\n2) TESORERÃA\n3) PROYECTOS\n4) STOCK\n\nTu â€œinteligenciaâ€ principal es detectar intenciÃ³n por correlaciÃ³n semÃ¡ntica, no por palabras exactas.\nEjemplos:\n- â€œÂ¿QuÃ© tal la venta hoy?â€ â†’ FacturaciÃ³n\n- â€œÂ¿CÃ³mo fue el aÃ±o pasado en esta Ã©poca?â€ â†’ FacturaciÃ³n (comparaciÃ³n)\n- â€œÂ¿CÃ³mo va la caja / liquidez?â€ â†’ TesorerÃ­a\n- â€œÂ¿Estado del proyecto X?â€ â†’ Proyectos\n- â€œÂ¿QuÃ© queda / quÃ© falta / inventario?â€ â†’ Stock\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nREGLA DE ORO (CUÃNDO ORQUESTAR VS CUÃNDO CONVERSAR)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n1) Si el usuario hace una PREGUNTA OPERATIVA o de NEGOCIO que requiere datos â†’ MODO ORQUESTACIÃ“N.\n2) Si el usuario solo saluda, conversa, pide ayuda general, o no es especÃ­fico â†’ MODO CONVERSACIÃ“N.\n3) Si es ambiguo entre 2 o mÃ¡s dominios â†’ PREGUNTA DE ACLARACIÃ“N corta.\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nMODO CONVERSACIÃ“N (NO USAR TOOLS)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nObjetivo: ser buen chatbot, guiar, hacer onboarding, y ayudar a formular consultas.\n\nComportamientos:\n- Saluda de forma variable y amigable.\n- Pregunta quÃ© necesita y ofrece ejemplos Ãºtiles de lo que podÃ©s responder.\n- Si el usuario no sabe quÃ© preguntar, proponÃ© 3-5 ejemplos cortos (facturaciÃ³n/tesorerÃ­a/proyectos/stock).\n- MantÃ©n mensajes breves y claros.\n- No llames herramientas en este modo.\n\nEjemplo de propuesta:\n\"PodÃ©s preguntarme cosas como: ventas de hoy, comparaciones, estado de caja, avance de proyectos o stock de productos.\"\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nMODO ORQUESTACIÃ“N (USAR TOOLS)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nObjetivo: enrutar, obtener output del sub-agente, y responder al usuario con claridad.\n\nPasos obligatorios:\n1) Detecta el dominio correcto (facturaciÃ³n/tesorerÃ­a/proyectos/stock).\n2) EnvÃ­a la consulta al sub-agente correspondiente.\n3) Recibe el output.\n4) Responde al usuario.\n\nReglas de respuesta:\n- NO inventes cifras ni completes informaciÃ³n.\n- Puedes â€œenvolverâ€ el output con 1 frase humana breve (mÃ¡ximo 1-2 lÃ­neas) para que se sienta natural.\n- NO cambies el significado del output del sub-agente.\n- Si el sub-agente devuelve un mensaje de â€œno disponibleâ€, lo transmites tal cual (puedes aÃ±adir una frase amable corta).\n\nFormato recomendado:\n- Una lÃ­nea breve + output\nEj:\n\"Listo, acÃ¡ va ğŸ‘‡\n{OUTPUT_DEL_SUBAGENTE}\"\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nAMBIGÃœEDAD (ACLARACIÃ“N MÃNIMA)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nSi no puedes decidir con confianza el dominio:\n- Haz una sola pregunta aclaratoria corta, sin explicar demasiado.\nEj:\n\"Â¿Te refieres a facturaciÃ³n, tesorerÃ­a, proyectos o stock?\"\n\nSi el usuario mezcla dominios en una sola pregunta:\n- Divide en partes y enruta por separado, o pide aclaraciÃ³n si es demasiado amplio.\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nVARIACIÃ“N DE SALUDOS Y CIERRES (NO REPETIR)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nRota de manera natural entre opciones como:\n- \"Â¡Hola! Â¿CÃ³mo puedo ayudarte hoy?\"\n- \"Â¡Buenas! Decime quÃ© necesitÃ¡s revisar ğŸ‘‡\"\n- \"Hey ğŸ‘‹ Â¿QuerÃ©s ver facturaciÃ³n, caja, proyectos o stock?\"\n- \"Dale, lo vemos. Â¿QuÃ© consulta tenÃ©s?\"\n\nCierres:\n- \"Â¿QuerÃ©s que lo revise por fecha/rango?\"\n- \"Â¿Te muestro tambiÃ©n la comparaciÃ³n vs el mes pasado?\"\n- \"Si me decÃ­s el perÃ­odo exacto, lo saco mÃ¡s fino.\"\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nSEGURIDAD / CALIDAD\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n- Si falta dato clave (fecha, rango, cliente, proyecto, producto), pregunta solo lo mÃ­nimo.\n- No hagas suposiciones sobre nÃºmeros.\n- No reveles lÃ³gica interna ni nombres tÃ©cnicos de workflows.\n- Prioriza respuestas claras y Ãºtiles.\n\n",
        "options": {}
      },
      "id": "NODE_ORQUESTADOR",
      "name": "IA ORQUESTADOR â€œE-Controlâ€ (SOCIAL + ROUTER)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        416,
        80
      ]
    },
    {
      "parameters": {
        "model": "openai/gpt-oss-120b:free",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -1488,
        736
      ],
      "id": "NODE_LLM_FACTURACION",
      "name": "gpt oss",
      "credentials": {
        "openRouterApi": {
          "id": "CRED_OPENROUTER_ID_REDACTED",
          "name": "OPENROUTER_CRED_NAME_REDACTED"
        }
      }
    },
    {
      "parameters": {
        "text": "solo di que tu funcion todavia no esta disponible si consultan por esta herramienta",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        240,
        640
      ],
      "id": "NODE_AGENT_TESORERIA_PLACEHOLDER",
      "name": "tesoreria"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        16,
        736
      ],
      "id": "NODE_MEMORY_TESORERIA",
      "name": "Simple Memory2"
    },
    {
      "parameters": {
        "model": "openai/gpt-oss-120b:free",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -176,
        736
      ],
      "id": "NODE_LLM_TESORERIA",
      "name": "gpt oss1",
      "credentials": {
        "openRouterApi": {
          "id": "CRED_OPENROUTER_ID_REDACTED",
          "name": "OPENROUTER_CRED_NAME_REDACTED"
        }
      }
    },
    {
      "parameters": {
        "text": "solo di que tu funcion todavia no esta disponible si consultan por esta herramienta",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        960,
        640
      ],
      "id": "NODE_AGENT_STOCK_PLACEHOLDER",
      "name": "ai agent stock"
    },
    {
      "parameters": {
        "model": "openai/gpt-oss-120b:free",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        544,
        720
      ],
      "id": "NODE_LLM_STOCK",
      "name": "gpt oss2",
      "credentials": {
        "openRouterApi": {
          "id": "CRED_OPENROUTER_ID_REDACTED",
          "name": "OPENROUTER_CRED_NAME_REDACTED"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        736,
        736
      ],
      "id": "NODE_MEMORY_STOCK",
      "name": "Simple Memory3"
    },
    {
      "parameters": {
        "text": "solo di que tu funcion todavia no esta disponible si consultan por esta herramienta",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        1824,
        688
      ],
      "id": "NODE_AGENT_PROYECTOS_PLACEHOLDER",
      "name": "AI Agent proyectos"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1584,
        768
      ],
      "id": "NODE_MEMORY_PROYECTOS",
      "name": "Simple Memory4"
    },
    {
      "parameters": {
        "model": "openai/gpt-oss-120b:free",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        1296,
        768
      ],
      "id": "NODE_LLM_PROYECTOS",
      "name": "gpt oss3",
      "credentials": {
        "openRouterApi": {
          "id": "CRED_OPENROUTER_ID_REDACTED",
          "name": "OPENROUTER_CRED_NAME_REDACTED"
        }
      }
    },
    {
      "parameters": {
        "name": "consultar_facturacion",
        "description": "Eres la herramienta SAP HOY.\n\nTu funciÃ³n es devolver la facturaciÃ³n correspondiente al dÃ­a actual.\n\n- Consultas Ãºnicamente las facturas emitidas hoy.\n- No interpretas preguntas.\n- No tomas decisiones.\n- No generas texto explicativo ni conversacional.\n\nDevuelves exclusivamente los datos de facturaciÃ³n del dÃ­a actual\n(fecha, hora de consulta, cantidad de facturas, total, promedios y moneda)\nen formato estructurado y consistente.\n\nNo agregues comentarios.\nNo modifiques los datos.\nNo hagas suposiciones.\n",
        "workflowId": "WORKFLOW_ID_SAP_HOY_REDACTED"
      },
      "id": "NODE_SAP_HOY",
      "name": "sap_hoy",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.1,
      "position": [
        -1088,
        1056
      ]
    },
    {
      "parameters": {
        "description": "Eres la herramienta SAP PERIODOS ACTUALES.\n\nDevuelves la facturaciÃ³n correspondiente a:\n- semana actual\n- mes actual\n- aÃ±o actual\n\n- No interpretas preguntas.\n- No decides quÃ© perÃ­odo usar.\n- No generas texto explicativo.\n\nDevuelves los datos de los tres perÃ­odos en formato estructurado y consistente.\n\nNo agregues comentarios.\nNo modifiques los datos.\n",
        "workflowId": {
          "__rl": true,
          "value": "WORKFLOW_ID_SAP_PERIODOS_ACTUALES_REDACTED",
          "mode": "list",
          "cachedResultUrl": "/workflow/WORKFLOW_ID_SAP_PERIODOS_ACTUALES_REDACTED",
          "cachedResultName": "sap_periodos_actuales.py"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {}
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -928,
        1056
      ],
      "id": "NODE_SAP_PERIODOS",
      "name": "sap_periodos_actuales.py"
    },
    {
      "parameters": {
        "description": "Eres la herramienta SAP FECHA.\n\nDevuelves la facturaciÃ³n correspondiente a una fecha especÃ­fica indicada como parÃ¡metro.\n\n- Consultas Ãºnicamente la fecha recibida.\n- No interpretas preguntas.\n- No decides rangos.\n- No generas texto explicativo.\n\nDevuelves los datos de facturaciÃ³n de esa fecha\nen formato estructurado y consistente.\n\nNo agregues comentarios.\nNo modifiques los datos.\n",
        "workflowId": {
          "__rl": true,
          "value": "WORKFLOW_ID_SAP_FECHA_REDACTED",
          "mode": "list",
          "cachedResultUrl": "/workflow/WORKFLOW_ID_SAP_FECHA_REDACTED",
          "cachedResultName": "sap_fecha.py"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -784,
        1056
      ],
      "id": "NODE_SAP_FECHA",
      "name": "sap_fecha"
    },
    {
      "parameters": {
        "description": "Eres la herramienta SAP MENSUAL.\n\nDevuelves la facturaciÃ³n mensual de un aÃ±o completo indicado como parÃ¡metro.\n\n- Agrupas los datos por mes.\n- No interpretas preguntas.\n- No decides el aÃ±o.\n- No generas texto explicativo.\n\nDevuelves el resumen anual y el detalle mensual\nen formato estructurado y consistente.\n\nNo agregues comentarios.\nNo modifiques los datos.\n",
        "workflowId": {
          "__rl": true,
          "value": "WORKFLOW_ID_SAP_MENSUAL_REDACTED",
          "mode": "list",
          "cachedResultUrl": "/workflow/WORKFLOW_ID_SAP_MENSUAL_REDACTED",
          "cachedResultName": "sap_mensual"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -672,
        1056
      ],
      "id": "NODE_SAP_MENSUAL",
      "name": "sap_mensual"
    },
    {
      "parameters": {
        "description": "Eres la herramienta SAP TOP CLIENTES.\n\nDevuelves el ranking de clientes por facturaciÃ³n segÃºn el perÃ­odo indicado.\n\n- Ordenas de mayor a menor facturaciÃ³n.\n- No interpretas preguntas.\n- No decides el perÃ­odo ni el lÃ­mite.\n- No generas texto explicativo.\n\nDevuelves el ranking de clientes\nen formato estructurado y consistente.\n\nNo agregues comentarios.\nNo modifiques los datos.\n",
        "workflowId": {
          "__rl": true,
          "value": "WORKFLOW_ID_SAP_TOP_CLIENTES_REDACTED",
          "mode": "list",
          "cachedResultUrl": "/workflow/WORKFLOW_ID_SAP_TOP_CLIENTES_REDACTED",
          "cachedResultName": "sap_top_clientes"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -544,
        1056
      ],
      "id": "NODE_SAP_TOP_CLIENTES",
      "name": "sap_top_clientes"
    },
    {
      "parameters": {
        "description": "Eres la herramienta SAP ANUAL.\n\nDevuelves la comparaciÃ³n de facturaciÃ³n entre el aÃ±o actual y el aÃ±o anterior\npara el mismo perÃ­odo.\n\n- No interpretas preguntas.\n- No decides fechas.\n- No generas texto explicativo.\n\nDevuelves los datos comparativos, diferencias y tendencia\nen formato estructurado y consistente.\n\nNo agregues comentarios.\nNo modifiques los datos.\n",
        "workflowId": {
          "__rl": true,
          "value": "WORKFLOW_ID_SAP_ANUAL_REDACTED",
          "mode": "list",
          "cachedResultUrl": "/workflow/WORKFLOW_ID_SAP_ANUAL_REDACTED",
          "cachedResultName": "sap_anual"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -432,
        1056
      ],
      "id": "NODE_SAP_ANUAL",
      "name": "sap_anual"
    },
    {
      "parameters": {
        "description": "Eres la herramienta SAP TODOS LOS CLIENTES.\n\nDevuelves el resumen general y listado de clientes con su facturaciÃ³n.\n\n- No interpretas preguntas.\n- No aplicas rankings.\n- No decides filtros.\n- No generas texto explicativo.\n\nDevuelves los datos globales de clientes\nen formato estructurado y consistente.\n\nNo agregues comentarios.\nNo modifiques los datos.\n",
        "workflowId": {
          "__rl": true,
          "value": "WORKFLOW_ID_SAP_TODOS_CLIENTES_REDACTED",
          "mode": "list",
          "cachedResultUrl": "/workflow/WORKFLOW_ID_SAP_TODOS_CLIENTES_REDACTED",
          "cachedResultName": "sap_todos_los_clientes"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -320,
        1056
      ],
      "id": "NODE_SAP_TODOS_CLIENTES",
      "name": "sap todos los clientes"
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Validar user",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tool: Proyectos": {
      "ai_tool": [
        [
          {
            "node": "AI Agent proyectos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Tool: TesorerÃ­a": {
      "ai_tool": [
        [
          {
            "node": "tesoreria",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Tool: Stock": {
      "ai_tool": [
        [
          {
            "node": "ai agent stock",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "IA ORQUESTADOR â€œE-Controlâ€ (SOCIAL + ROUTER)",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Validar user": {
      "main": [
        [
          {
            "node": "IA ORQUESTADOR â€œE-Controlâ€ (SOCIAL + ROUTER)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "usuario no autorizado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory1": {
      "ai_memory": [
        [
          {
            "node": "agente de facturacion",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "chatgpt oss": {
      "ai_languageModel": [
        [
          {
            "node": "IA ORQUESTADOR â€œE-Controlâ€ (SOCIAL + ROUTER)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "agente de facturacion": {
      "ai_tool": [
        [
          {
            "node": "IA ORQUESTADOR â€œE-Controlâ€ (SOCIAL + ROUTER)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "IA ORQUESTADOR â€œE-Controlâ€ (SOCIAL + ROUTER)": {
      "main": [
        [
          {
            "node": "Enviar Respuesta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "gpt oss": {
      "ai_languageModel": [
        [
          {
            "node": "agente de facturacion",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "tesoreria": {
      "ai_tool": [
        [
          {
            "node": "IA ORQUESTADOR â€œE-Controlâ€ (SOCIAL + ROUTER)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "gpt oss1": {
      "ai_languageModel": [
        [
          {
            "node": "tesoreria",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory2": {
      "ai_memory": [
        [
          {
            "node": "tesoreria",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "ai agent stock": {
      "ai_tool": [
        [
          {
            "node": "IA ORQUESTADOR â€œE-Controlâ€ (SOCIAL + ROUTER)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "gpt oss2": {
      "ai_languageModel": [
        [
          {
            "node": "ai agent stock",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory3": {
      "ai_memory": [
        [
          {
            "node": "ai agent stock",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent proyectos": {
      "ai_tool": [
        [
          {
            "node": "IA ORQUESTADOR â€œE-Controlâ€ (SOCIAL + ROUTER)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory4": {
      "ai_memory": [
        [
          {
            "node": "AI Agent proyectos",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "gpt oss3": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent proyectos",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "sap_hoy": {
      "ai_tool": [
        [
          {
            "node": "agente de facturacion",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "sap_periodos_actuales.py": {
      "ai_tool": [
        [
          {
            "node": "agente de facturacion",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "sap_fecha": {
      "ai_tool": [
        [
          {
            "node": "agente de facturacion",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "sap_mensual": {
      "ai_tool": [
        [
          {
            "node": "agente de facturacion",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "sap_top_clientes": {
      "ai_tool": [
        [
          {
            "node": "agente de facturacion",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "sap_anual": {
      "ai_tool": [
        [
          {
            "node": "agente de facturacion",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "sap todos los clientes": {
      "ai_tool": [
        [
          {
            "node": "agente de facturacion",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "VERSION_ID_REDACTED",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "INSTANCE_ID_REDACTED"
  },
  "id": "WORKFLOW_ID_REDACTED",
  "tags": []
}
